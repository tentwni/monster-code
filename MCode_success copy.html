<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>æ‹¯æ•‘æç§‘é¤¨å¤§æŒ‘æˆ°</title>
  <style>
    #gameTitle {
      font-size: 48px;
      font-family: 'Impact', 'Arial Black', sans-serif;
      color: #fff;
      text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7), 0 0 15px #f5d142;
      margin-bottom: 20px;
    }

    body {
      font-family: "Microsoft JhengHei", sans-serif;
      text-align: center;
      background: url("images/dark cave.jpeg") no-repeat center center fixed;
      background-size: cover;
      color: #fff;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
    }
    .hidden {
      display: none;
    }
    img.monster {
      width: 200px;
      animation: float 2s ease-in-out infinite;
    }
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-15px); }
      100% { transform: translateY(0px); }
    }
    .question-block {
      margin-top: 20px;
      text-align: left;
    }
    .choices button {
      margin: 5px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
    }
    .choices button.correct {
      background-color: #c6f6c3;
    }
    .choices button.wrong {
      background-color: #f6c3c3;
    }
    .hp {
      margin: 10px;
      font-weight: bold;
    }

    .hit-effect {
      animation: popFade 1s ease-in-out;
      pointer-events: none;
      z-index: 9999;
    }
    @keyframes popFade {
      0% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
      50% {
        transform: translate(-50%, -60%) scale(1.5);
        opacity: 0.8;
      }
      100% {
        transform: translate(-50%, -70%) scale(0.5);
        opacity: 0;
      }
    }
    #progressText {
      color: #333;
      font-weight: bold;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
<audio id="bgMusic" loop>
    <source src="luther.mp3" type="audio/mpeg" />
  </audio>
  <!-- éŸ³æ¨‚é–‹é—œæŒ‰éˆ• -->
  <button onclick="toggleMusic()">ğŸµ éŸ³æ¨‚é–‹é—œ</button>

  <div class="container">
    <div id="startScreen">
      <h1 id="gameTitle">æ‹¯æ•‘æç§‘é¤¨å¤§æŒ‘æˆ°</h1>
      <input type="text" id="playerName" placeholder="è«‹è¼¸å…¥ä½ çš„åå­—" />
      <button onclick="startGame()">é–‹å§‹æŒ‘æˆ°</button>
    </div>
    <div id="progressContainer" style="margin-bottom: 10px;">
      <div id="progressText">æ“Šæ•—æ€ªç‰©ï¼š0/5</div>
      <div style="background: #ccc; width: 100%; height: 20px; border-radius: 10px;">
        <div id="progressBar" style="background: #4caf50; width: 0%; height: 100%; border-radius: 10px;"></div>
      </div>
    </div>
      <h2>æŒ‘æˆ°é€²åº¦</h2>
      <div id="progress"></div>
    <div id="levelSelectScreen" class="hidden">
      <h2>é¸æ“‡è¦æŒ‘æˆ°çš„æ€ªç‰©</h2>
      <div id="levelButtons"></div>
    </div>
    <div id="gameScreen" class="hidden">
      <div id="status">
        <p class="hp" id="playerHP"></p>
        <p class="hp" id="monsterHP"></p>
      </div>
      <img id="monsterImg" class="monster" src="" alt="æ€ªç‰©" />
      <div id="questionContainer"></div>
    </div>
    <div id="endScreen" class="hidden">
      <h2 id="endMessage"></h2>
    </div>
  </div>
  <script>
    const monsters = [
      {
        name: "Goblin",
        image: "images/goblin.png",
        questions: [
          { q: "æ¸…è¯ææ–™ç§‘æŠ€é¤¨ä¸»è¦ä»‹ç´¹å“ªå€‹ä¸»é¡Œï¼Ÿ", c: ["A. å‹•ç‰©æ¼”åŒ–", "B. å»ºç¯‰æ­·å²", "C. ææ–™ç§‘å­¸èˆ‡æ‡‰ç”¨", "D. é£Ÿå“ç‡Ÿé¤Š"], a: "C" },
          { q: "å“ªä¸€ç¨®é‡‘å±¬å¯ä»¥åœ¨åŠ ç†±å¾Œå›å¾©åŸä¾†çš„å½¢ç‹€ï¼Ÿ", c: ["A. é‹", "B. é‹¼éµ", "C. éˆ¦åˆé‡‘", "D. å½¢ç‹€è¨˜æ†¶åˆé‡‘"], a: "D" },
          { q: "è™›æ“¬å¯¦å¢ƒï¼ˆVRï¼‰å°è¦½çš„ç‰¹è‰²æ˜¯ï¼Ÿ", c: ["A. åªèƒ½çœ‹å½±ç‰‡", "B. èƒ½æ¨¡æ“¬èµ°é€²å±•å ´ä¸¦èˆ‡å±•å“äº’å‹•", "C. è½èªéŸ³ä»‹ç´¹", "D. é ç«¯æ“ä½œé›»è…¦"], a: "B" }
        ]
      },
      {
        name: "Troll",
        image: "images/troll.png",
        questions: [
          { q: "å¥ˆç±³ææ–™çš„ã€Œå¥ˆç±³ã€æŒ‡çš„æ˜¯ï¼Ÿ", c: ["A. ä¸€ç¨®é‡‘å±¬", "B. ä¸€ç¨®é¡è‰²", "C. éå¸¸å°çš„é•·åº¦å–®ä½", "D. é›»å­ç”¢å“å“ç‰Œ"], a: "C" },
          { q: "ä¸‹åˆ—å“ªä¸€ç¨®æ˜¯ã€Œé«˜åˆ†å­ææ–™ã€ï¼Ÿ", c: ["A. éµç‰‡", "B. ç»ç’ƒæ¯", "C. å¡‘è† è¢‹", "D. é‰›ç­†èŠ¯"], a: "C" },
          { q: "3Dåˆ—å°æ˜¯æ€éº¼è£½ä½œç«‹é«”ç‰©å“çš„ï¼Ÿ", c: ["A. ç”¨æ¨¡å…·å£“å‡ºä¾†", "B. ç”¨é›·å°„é›•åˆ»", "C. ä¸€å±¤å±¤å †ç–Šææ–™", "D. åˆ‡å‰²æœ¨é ­å†é»åˆ"], a: "C" }
        ]
      },
      {
        name: "Snake",
        image: "images/snake.png",
        questions: [
          { q: "å“ªä¸€å€‹å±¬æ–¼ã€Œå†ç”Ÿææ–™ã€çš„æ‡‰ç”¨ï¼Ÿ", c: ["A. éµç¤¦çŸ³ç…‰éµ", "B. ç”¨å¡‘è† ç“¶åšè¡£æœ", "C. æœ¨æå»ºå±‹", "D. ç”¨ç»ç’ƒåšçª—æˆ¶"], a: "B" },
          { q: "ç‚ºä»€éº¼é‡‘å±¬æ¯”æœ¨é ­æ›´å®¹æ˜“å°ç†±ï¼Ÿ", c: ["A. æ¯”è¼ƒé‡", "B. åŸå­æ’åˆ—æ›´è¦å‰‡", "C. è¡¨é¢å…‰æ»‘", "D. é‡‘å±¬æ¯”è¼ƒè²´"], a: "B" },
          { q: "ã€Œç”Ÿé†«ææ–™ã€ä¸»è¦æ‡‰ç”¨åœ¨ï¼Ÿ", c: ["A. è—¥å“åŒ…è£", "B. é†«ç™‚æ¤å…¥ç‰©èˆ‡å‡é«”", "C. é«”è‚²ç”¨å“", "D. æ›¸æœ¬å°åˆ·"], a: "B" }
        ]
      },
      {
        name: "Wolf",
        image: "images/wolf.png",
        questions: [
          { q: "ç†±è™•ç†å°é‡‘å±¬ææ–™çš„ä¸»è¦å½±éŸ¿æ˜¯ï¼Ÿ", c: ["A. æ”¹è®Šé¡è‰²", "B. è®“å®ƒè®Šè¼•", "C. æ”¹è®Šç¡¬åº¦å’Œå¼·åº¦", "D. è®“å®ƒè®Šæˆæ¶²é«”"], a: "C" },
          { q: "å“ªä¸€å€‹å±•å“ä¸»é¡Œå¯èƒ½æœƒå‡ºç¾åœ¨æ¸…å¤§ææ–™ç§‘æŠ€é¤¨ï¼Ÿ", c: ["A. æ¤ç‰©åˆ†é¡", "B. å…‰é›»ææ–™", "C. ç«å±±å™´ç™¼", "D. é‹å‹•ç§‘å­¸"], a: "B" },
          { q: "åœ¨VRå°è¦½ä¸­ï¼Œè§€çœ¾å¯ä»¥åšä»€éº¼ï¼Ÿ", c: ["A. è‡ªç”±ç§»å‹•ä¸¦é»é¸å±•å“ç²å¾—èªªæ˜", "B. ç©å°„æ“ŠéŠæˆ²", "C. æ”¹è®Šå±•å“å…§å®¹", "D. æ‹ç…§ä¸Šå‚³æ‰“å¡"], a: "A" }
        ]
      },
      {
        name: "Dragon",
        image: "images/dragon.png",
        questions: [
          { q: "æ¸…å¤§ææ–™ç§‘æŠ€é¤¨å¸Œæœ›åƒè§€è€…å¾ä¸­å­¸åˆ°ä»€éº¼ï¼Ÿ", c: ["A. å¦‚ä½•ç•«ç•«", "B. å¦‚ä½•è®Šè°æ˜", "C. ææ–™å¦‚ä½•æ‡‰ç”¨åœ¨ç”Ÿæ´»å’Œç§‘æŠ€ä¸­", "D. å„åœ‹æ–‡åŒ–å·®ç•°"], a: "C" },
          { q: "ç‚ºä»€éº¼å¥ˆç±³ææ–™ç‰¹åˆ¥ï¼Ÿ", c: ["A. æ¯”å…¶ä»–ææ–™ä¾¿å®œ", "B. å®¹æ˜“ç”¨è‚‰çœ¼è§€å¯Ÿ", "C. åœ¨å¾ˆå°çš„å°ºåº¦ä¸‹æœƒå‡ºç¾ç‰¹åˆ¥çš„æ€§è³ª", "D. åªç”¨åœ¨æ©Ÿå™¨äººä¸Š"], a: "C" },
          { q: "å“ªä¸€ç¨®ææ–™å¸¸è¢«ç”¨åœ¨å¤ªé™½èƒ½æ¿ä¸­ï¼Ÿ", c: ["A. éµ", "B. éŠ…", "C. çŸ½", "D. é‹ç®”"], a: "C" }
        ]
      }
    ];

    let playerHP = 3;
    let monsterHP = 3;
    let currentMonster = 0;
    let playerName = "";
    let defeatedMonsters = new Array(monsters.length).fill(false);

    function startGame() {
      playerName = document.getElementById("playerName").value;
      if (!playerName) return alert("è«‹è¼¸å…¥åå­—ï¼");
      localStorage.setItem("playerName", playerName);
      document.getElementById("startScreen").classList.add("hidden");
      document.getElementById("levelSelectScreen").classList.remove("hidden");
      generateLevelButtons();
    }

   function generateLevelButtons() {
     const container = document.getElementById("levelButtons");
     container.innerHTML = "";
     
     monsters.forEach((monster, index) => {
       const btn = document.createElement("button");
       btn.textContent = `LV${index + 1}: ${monster.name}`;
       btn.disabled = defeatedMonsters[index]; 
       if (btn.disabled) btn.style.backgroundColor = "#ccc"; // Disable button style
       
       btn.onclick = () => {
         currentMonster = index;
         document.getElementById("levelSelectScreen").classList.add("hidden");
         document.getElementById("gameScreen").classList.remove("hidden");
         document.getElementById("bgMusic").play();
         showMonster();
      };
       container.appendChild(btn);
     });

     const defeatedCount = defeatedMonsters.filter(x => x).length;
     const percent = (defeatedCount / monsters.length) * 100;
     document.getElementById("progressText").textContent = `æ“Šæ•—æ€ªç‰©ï¼š${defeatedCount}/${monsters.length}`;
     document.getElementById("progressBar").style.width = `${percent}%`;
   }

    function showMonster() {
      playerHP = 3;
      monsterHP = 3;
      questionsAnswered = 0;
      answeredQuestions = new Array(3).fill(false);
      document.getElementById("playerHP").textContent = `${playerName} HP: ${playerHP}`;
      document.getElementById("monsterHP").textContent = `${monsters[currentMonster].name} HP: ${monsterHP}`;
      document.getElementById("monsterImg").src = monsters[currentMonster].image;
      renderQuestions();
    }

    let questionsAnswered = 0;
    let answeredQuestions = [];

    function renderQuestions() {
      const container = document.getElementById("questionContainer");
      container.innerHTML = "";
      monsters[currentMonster].questions.forEach((q, index) => {
        const block = document.createElement("div");
        block.className = "question-block";
        block.innerHTML = `<p>${index + 1}. ${q.q}</p>`;
        const btns = document.createElement("div");
        btns.className = "choices";
        q.c.forEach((choice) => {
          const btn = document.createElement("button");
          btn.textContent = choice;
          btn.onclick = () => handleAnswer(btn, choice, q.a, index, btns);
          btns.appendChild(btn);
        });
        block.appendChild(btns);
        container.appendChild(block);
      });
    }

    function handleAnswer(button, selected, correct, index, btnContainer) {
      if (answeredQuestions[index]) return; // Already answered correctly

      if (selected.startsWith(correct)) {
        monsterHP--;
        answeredQuestions[index] = true;
        button.classList.add("correct");
        disableChoices(btnContainer);
        triggerHitEffect();
      } else {
        playerHP--;
        button.classList.add("wrong");
      }

      function triggerHitEffect() {
        const hitEffect = document.createElement("div");
        hitEffect.className = "hit-effect";
        hitEffect.style.position = "absolute";
        hitEffect.style.top = "50%";
        hitEffect.style.left = "50%";
        hitEffect.style.transform = "translate(-50%, -50%)";
        hitEffect.style.fontSize = "32px";
        hitEffect.style.fontWeight = "bold";
        hitEffect.style.color = "#ff4444";
        hitEffect.textContent = "Hit!";
        document.body.appendChild(hitEffect);
        setTimeout(() => {
          document.body.removeChild(hitEffect);
        }, 1000);
      }

      document.getElementById("playerHP").textContent = `${playerName} HP: ${playerHP}`;
      document.getElementById("monsterHP").textContent = `${monsters[currentMonster].name} HP: ${monsterHP}`;

      checkProgress();
    }

    function disableChoices(container) {
      const buttons = container.querySelectorAll("button");
      buttons.forEach(btn => btn.disabled = true);
    }

    function checkProgress() {
      if (playerHP <= 0) {
        endGame("ä½ è¢«æ“Šæ•—äº†");
      } else if (answeredQuestions.filter(a => a).length === 3) {
        if (monsterHP <= 0) {
          defeatedMonsters[currentMonster] = true;
          localStorage.setItem("defeatedMonsters", JSON.stringify(defeatedMonsters));

          if (defeatedMonsters.every(status => status)) {
            setTimeout(() => {
              endGame("ä½ æˆåŠŸæ“Šæ•—æ‰€æœ‰æ€ªç¸ï¼Œæ‹¯æ•‘äº†æç§‘é¤¨ï¼");
            }, 1000);
          } else {
            document.getElementById("levelSelectScreen").classList.remove("hidden");
            document.getElementById("gameScreen").classList.add("hidden");
            generateLevelButtons();
          }
        } else {
          endGame("ä½ è¢«æ“Šæ•—äº†");
        }
      }
    }

    function endGame(msg) {
      generateLevelButtons();
      document.getElementById("gameScreen").classList.add("hidden");
      document.getElementById("endScreen").classList.remove("hidden");
      document.getElementById("endMessage").textContent = msg;
      if (msg.includes("æ‹¯æ•‘äº†æç§‘é¤¨")) {
        document.getElementById("bgMusic").pause();
        localStorage.removeItem("playerName");
        localStorage.removeItem("defeatedMonsters");
      }
    }
    window.onload = () => {
      const savedName = localStorage.getItem("playerName");
      const savedDefeated = localStorage.getItem("defeatedMonsters");

      if (savedName) {
        playerName = savedName;
        document.getElementById("startScreen").classList.add("hidden");
        document.getElementById("levelSelectScreen").classList.remove("hidden");
        
        if (savedDefeated) {
          defeatedMonsters = JSON.parse(savedDefeated);
        } 
        generateLevelButtons();
      }
    };
  </script>
</body>
</html>